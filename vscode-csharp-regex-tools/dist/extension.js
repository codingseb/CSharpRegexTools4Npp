"use strict";var Mn=Object.create;var qe=Object.defineProperty;var jn=Object.getOwnPropertyDescriptor;var qn=Object.getOwnPropertyNames;var Ln=Object.getPrototypeOf,Dn=Object.prototype.hasOwnProperty;var q=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),$n=(r,e)=>{for(var t in e)qe(r,t,{get:e[t],enumerable:!0})},Or=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of qn(e))!Dn.call(r,s)&&s!==t&&qe(r,s,{get:()=>e[s],enumerable:!(n=jn(e,s))||n.enumerable});return r};var at=(r,e,t)=>(t=r!=null?Mn(Ln(r)):{},Or(e||!r||!r.__esModule?qe(t,"default",{value:r,enumerable:!0}):t,r)),In=r=>Or(qe({},"__esModule",{value:!0}),r);var ge=q(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.stringArray=D.array=D.func=D.error=D.number=D.string=D.boolean=void 0;function An(r){return r===!0||r===!1}D.boolean=An;function Mr(r){return typeof r=="string"||r instanceof String}D.string=Mr;function Wn(r){return typeof r=="number"||r instanceof Number}D.number=Wn;function Bn(r){return r instanceof Error}D.error=Bn;function zn(r){return typeof r=="function"}D.func=zn;function jr(r){return Array.isArray(r)}D.array=jr;function Fn(r){return jr(r)&&r.every(e=>Mr(e))}D.stringArray=Fn});var Mt=q(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.Message=l.NotificationType9=l.NotificationType8=l.NotificationType7=l.NotificationType6=l.NotificationType5=l.NotificationType4=l.NotificationType3=l.NotificationType2=l.NotificationType1=l.NotificationType0=l.NotificationType=l.RequestType9=l.RequestType8=l.RequestType7=l.RequestType6=l.RequestType5=l.RequestType4=l.RequestType3=l.RequestType2=l.RequestType1=l.RequestType=l.RequestType0=l.AbstractMessageSignature=l.ParameterStructures=l.ResponseError=l.ErrorCodes=void 0;var ue=ge(),ct;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(ct||(l.ErrorCodes=ct={}));var ut=class r extends Error{constructor(e,t,n){super(t),this.code=ue.number(e)?e:ct.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};l.ResponseError=ut;var W=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};l.ParameterStructures=W;W.auto=new W("auto");W.byPosition=new W("byPosition");W.byName=new W("byName");var R=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return W.auto}};l.AbstractMessageSignature=R;var dt=class extends R{constructor(e){super(e,0)}};l.RequestType0=dt;var lt=class extends R{constructor(e,t=W.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};l.RequestType=lt;var ft=class extends R{constructor(e,t=W.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};l.RequestType1=ft;var ht=class extends R{constructor(e){super(e,2)}};l.RequestType2=ht;var pt=class extends R{constructor(e){super(e,3)}};l.RequestType3=pt;var mt=class extends R{constructor(e){super(e,4)}};l.RequestType4=mt;var gt=class extends R{constructor(e){super(e,5)}};l.RequestType5=gt;var yt=class extends R{constructor(e){super(e,6)}};l.RequestType6=yt;var bt=class extends R{constructor(e){super(e,7)}};l.RequestType7=bt;var vt=class extends R{constructor(e){super(e,8)}};l.RequestType8=vt;var wt=class extends R{constructor(e){super(e,9)}};l.RequestType9=wt;var _t=class extends R{constructor(e,t=W.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};l.NotificationType=_t;var St=class extends R{constructor(e){super(e,0)}};l.NotificationType0=St;var Rt=class extends R{constructor(e,t=W.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};l.NotificationType1=Rt;var Tt=class extends R{constructor(e){super(e,2)}};l.NotificationType2=Tt;var Pt=class extends R{constructor(e){super(e,3)}};l.NotificationType3=Pt;var Et=class extends R{constructor(e){super(e,4)}};l.NotificationType4=Et;var Ct=class extends R{constructor(e){super(e,5)}};l.NotificationType5=Ct;var Nt=class extends R{constructor(e){super(e,6)}};l.NotificationType6=Nt;var kt=class extends R{constructor(e){super(e,7)}};l.NotificationType7=kt;var xt=class extends R{constructor(e){super(e,8)}};l.NotificationType8=xt;var Ot=class extends R{constructor(e){super(e,9)}};l.NotificationType9=Ot;var qr;(function(r){function e(s){let u=s;return u&&ue.string(u.method)&&(ue.string(u.id)||ue.number(u.id))}r.isRequest=e;function t(s){let u=s;return u&&ue.string(u.method)&&s.id===void 0}r.isNotification=t;function n(s){let u=s;return u&&(u.result!==void 0||!!u.error)&&(ue.string(u.id)||ue.number(u.id)||u.id===null)}r.isResponse=n})(qr||(l.Message=qr={}))});var qt=q(re=>{"use strict";var Lr;Object.defineProperty(re,"__esModule",{value:!0});re.LRUCache=re.LinkedMap=re.Touch=void 0;var $;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})($||(re.Touch=$={}));var Le=class{constructor(){this[Lr]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=$.None){let n=this._map.get(e);if(n)return t!==$.None&&this.touch(n,t),n.value}set(e,t,n=$.None){let s=this._map.get(e);if(s)s.value=t,n!==$.None&&this.touch(s,n);else{switch(s={key:e,value:t,next:void 0,previous:void 0},n){case $.None:this.addItemLast(s);break;case $.First:this.addItemFirst(s);break;case $.Last:this.addItemLast(s);break;default:this.addItemLast(s);break}this._map.set(e,s),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,s=this._head;for(;s;){if(t?e.bind(t)(s.value,s.key,this):e(s.value,s.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");s=s.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:t.key,done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:t.value,done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let s={value:[t.key,t.value],done:!1};return t=t.next,s}else return{value:void 0,done:!0}}};return n}[(Lr=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==$.First&&t!==$.Last)){if(t===$.First){if(e===this._head)return;let n=e.next,s=e.previous;e===this._tail?(s.next=void 0,this._tail=s):(n.previous=s,s.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===$.Last){if(e===this._tail)return;let n=e.next,s=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=s,s.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};re.LinkedMap=Le;var jt=class extends Le{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=$.AsNew){return super.get(e,t)}peek(e){return super.get(e,$.None)}set(e,t){return super.set(e,t,$.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};re.LRUCache=jt});var $r=q(De=>{"use strict";Object.defineProperty(De,"__esModule",{value:!0});De.Disposable=void 0;var Dr;(function(r){function e(t){return{dispose:t}}r.create=e})(Dr||(De.Disposable=Dr={}))});var ne=q($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});var Lt;function Dt(){if(Lt===void 0)throw new Error("No runtime abstraction layer installed");return Lt}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");Lt=t}r.install=e})(Dt||(Dt={}));$t.default=Dt});var be=q(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.Emitter=ye.Event=void 0;var Un=ne(),Ir;(function(r){let e={dispose(){}};r.None=function(){return e}})(Ir||(ye.Event=Ir={}));var It=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let s=0,u=this._callbacks.length;s<u;s++)if(this._callbacks[s]===e)if(this._contexts[s]===t){this._callbacks.splice(s,1),this._contexts.splice(s,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),s=this._contexts.slice(0);for(let u=0,y=n.length;u<y;u++)try{t.push(n[u].apply(s[u],e))}catch(C){(0,Un.default)().console.error(C)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},$e=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new It),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let s={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),s.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(s),s}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};ye.Emitter=$e;$e._noop=function(){}});var We=q(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.CancellationTokenSource=ve.CancellationToken=void 0;var Hn=ne(),Jn=ge(),At=be(),Ie;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:At.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:At.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||Jn.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(Ie||(ve.CancellationToken=Ie={}));var Vn=Object.freeze(function(r,e){let t=(0,Hn.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),Ae=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Vn:(this._emitter||(this._emitter=new At.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},Wt=class{get token(){return this._token||(this._token=new Ae),this._token}cancel(){this._token?this._token.cancel():this._token=Ie.Cancelled}dispose(){this._token?this._token instanceof Ae&&this._token.dispose():this._token=Ie.None}};ve.CancellationTokenSource=Wt});var Ar=q(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.SharedArrayReceiverStrategy=we.SharedArraySenderStrategy=void 0;var Gn=We(),Ee;(function(r){r.Continue=0,r.Cancelled=1})(Ee||(Ee={}));var Bt=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=Ee.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let s=new Int32Array(n,0,1);Atomics.store(s,0,Ee.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};we.SharedArraySenderStrategy=Bt;var zt=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Ee.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Ft=class{constructor(e){this.token=new zt(e)}cancel(){}dispose(){}},Ut=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new Gn.CancellationTokenSource:new Ft(t)}};we.SharedArrayReceiverStrategy=Ut});var Jt=q(Be=>{"use strict";Object.defineProperty(Be,"__esModule",{value:!0});Be.Semaphore=void 0;var Qn=ne(),Ht=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,Qn.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Be.Semaphore=Ht});var Br=q(ie=>{"use strict";Object.defineProperty(ie,"__esModule",{value:!0});ie.ReadableStreamMessageReader=ie.AbstractMessageReader=ie.MessageReader=void 0;var Gt=ne(),_e=ge(),Vt=be(),Kn=Jt(),Wr;(function(r){function e(t){let n=t;return n&&_e.func(n.listen)&&_e.func(n.dispose)&&_e.func(n.onError)&&_e.func(n.onClose)&&_e.func(n.onPartialMessage)}r.is=e})(Wr||(ie.MessageReader=Wr={}));var ze=class{constructor(){this.errorEmitter=new Vt.Emitter,this.closeEmitter=new Vt.Emitter,this.partialMessageEmitter=new Vt.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${_e.string(e.message)?e.message:"unknown"}`)}};ie.AbstractMessageReader=ze;var Qt;(function(r){function e(t){let n,s,u,y=new Map,C,A=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(u=t.contentDecoder,y.set(u.name,u)),t.contentDecoders!==void 0)for(let O of t.contentDecoders)y.set(O.name,O);if(t.contentTypeDecoder!==void 0&&(C=t.contentTypeDecoder,A.set(C.name,C)),t.contentTypeDecoders!==void 0)for(let O of t.contentTypeDecoders)A.set(O.name,O)}return C===void 0&&(C=(0,Gt.default)().applicationJson.decoder,A.set(C.name,C)),{charset:n,contentDecoder:u,contentDecoders:y,contentTypeDecoder:C,contentTypeDecoders:A}}r.fromOptions=e})(Qt||(Qt={}));var Kt=class extends ze{constructor(e,t){super(),this.readable=e,this.options=Qt.fromOptions(t),this.buffer=(0,Gt.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new Kn.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let s=n.get("content-length");if(!s){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let u=parseInt(s);if(isNaN(u)){this.fireError(new Error(`Content-Length value must be a number. Got ${s}`));return}this.nextMessageLength=u}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,s=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(s)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,Gt.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};ie.ReadableStreamMessageReader=Kt});var Jr=q(se=>{"use strict";Object.defineProperty(se,"__esModule",{value:!0});se.WriteableStreamMessageWriter=se.AbstractMessageWriter=se.MessageWriter=void 0;var zr=ne(),Ce=ge(),Xn=Jt(),Fr=be(),Yn="Content-Length: ",Ur=`\r
`,Hr;(function(r){function e(t){let n=t;return n&&Ce.func(n.dispose)&&Ce.func(n.onClose)&&Ce.func(n.onError)&&Ce.func(n.write)}r.is=e})(Hr||(se.MessageWriter=Hr={}));var Fe=class{constructor(){this.errorEmitter=new Fr.Emitter,this.closeEmitter=new Fr.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Ce.string(e.message)?e.message:"unknown"}`)}};se.AbstractMessageWriter=Fe;var Xt;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,zr.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,zr.default)().applicationJson.encoder}}r.fromOptions=e})(Xt||(Xt={}));var Yt=class extends Fe{constructor(e,t){super(),this.writable=e,this.options=Xt.fromOptions(t),this.errorCount=0,this.writeSemaphore=new Xn.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let s=[];return s.push(Yn,n.byteLength.toString(),Ur),s.push(Ur),this.doWrite(e,s,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(s){return this.handleError(s,e),Promise.reject(s)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};se.WriteableStreamMessageWriter=Yt});var Vr=q(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.AbstractMessageBuffer=void 0;var Zn=13,ei=10,ti=`\r
`,Zt=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,s=0,u=0;e:for(;n<this._chunks.length;){let O=this._chunks[n];for(s=0;s<O.length;){switch(O[s]){case Zn:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case ei:switch(t){case 1:t=2;break;case 3:t=4,s++;break e;default:t=0}break;default:t=0}s++}u+=O.byteLength,n++}if(t!==4)return;let y=this._read(u+s),C=new Map,A=this.toString(y,"ascii").split(ti);if(A.length<2)return C;for(let O=0;O<A.length-2;O++){let V=A[O],Q=V.indexOf(":");if(Q===-1)throw new Error(`Message header must separate key and value using ':'
${V}`);let oe=V.substr(0,Q),fe=V.substr(Q+1).trim();C.set(e?oe.toLowerCase():oe,fe)}return C}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let u=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(u)}if(this._chunks[0].byteLength>e){let u=this._chunks[0],y=this.asNative(u,e);return this._chunks[0]=u.slice(e),this._totalLength-=e,y}let t=this.allocNative(e),n=0,s=0;for(;e>0;){let u=this._chunks[s];if(u.byteLength>e){let y=u.slice(0,e);t.set(y,n),n+=e,this._chunks[s]=u.slice(e),this._totalLength-=e,e-=e}else t.set(u,n),n+=u.byteLength,this._chunks.shift(),this._totalLength-=u.byteLength,e-=u.byteLength}return t}};Ue.AbstractMessageBuffer=Zt});var Yr=q(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.createMessageConnection=h.ConnectionOptions=h.MessageStrategy=h.CancellationStrategy=h.CancellationSenderStrategy=h.CancellationReceiverStrategy=h.RequestCancellationReceiverStrategy=h.IdCancellationReceiverStrategy=h.ConnectionStrategy=h.ConnectionError=h.ConnectionErrors=h.LogTraceNotification=h.SetTraceNotification=h.TraceFormat=h.TraceValues=h.Trace=h.NullLogger=h.ProgressType=h.ProgressToken=void 0;var Gr=ne(),P=ge(),f=Mt(),Qr=qt(),Ne=be(),er=We(),Oe;(function(r){r.type=new f.NotificationType("$/cancelRequest")})(Oe||(Oe={}));var tr;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(tr||(h.ProgressToken=tr={}));var ke;(function(r){r.type=new f.NotificationType("$/progress")})(ke||(ke={}));var rr=class{constructor(){}};h.ProgressType=rr;var nr;(function(r){function e(t){return P.func(t)}r.is=e})(nr||(nr={}));h.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var g;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(g||(h.Trace=g={}));var Kr;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(Kr||(h.TraceValues=Kr={}));(function(r){function e(n){if(!P.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(g||(h.Trace=g={}));var B;(function(r){r.Text="text",r.JSON="json"})(B||(h.TraceFormat=B={}));(function(r){function e(t){return P.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(B||(h.TraceFormat=B={}));var ir;(function(r){r.type=new f.NotificationType("$/setTrace")})(ir||(h.SetTraceNotification=ir={}));var He;(function(r){r.type=new f.NotificationType("$/logTrace")})(He||(h.LogTraceNotification=He={}));var xe;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(xe||(h.ConnectionErrors=xe={}));var Se=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};h.ConnectionError=Se;var sr;(function(r){function e(t){let n=t;return n&&P.func(n.cancelUndispatched)}r.is=e})(sr||(h.ConnectionStrategy=sr={}));var Je;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&P.func(n.createCancellationTokenSource)&&(n.dispose===void 0||P.func(n.dispose))}r.is=e})(Je||(h.IdCancellationReceiverStrategy=Je={}));var or;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&P.func(n.createCancellationTokenSource)&&(n.dispose===void 0||P.func(n.dispose))}r.is=e})(or||(h.RequestCancellationReceiverStrategy=or={}));var Ve;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new er.CancellationTokenSource}});function e(t){return Je.is(t)||or.is(t)}r.is=e})(Ve||(h.CancellationReceiverStrategy=Ve={}));var Ge;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(Oe.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&P.func(n.sendCancellation)&&P.func(n.cleanup)}r.is=e})(Ge||(h.CancellationSenderStrategy=Ge={}));var Qe;(function(r){r.Message=Object.freeze({receiver:Ve.Message,sender:Ge.Message});function e(t){let n=t;return n&&Ve.is(n.receiver)&&Ge.is(n.sender)}r.is=e})(Qe||(h.CancellationStrategy=Qe={}));var Ke;(function(r){function e(t){let n=t;return n&&P.func(n.handleMessage)}r.is=e})(Ke||(h.MessageStrategy=Ke={}));var Xr;(function(r){function e(t){let n=t;return n&&(Qe.is(n.cancellationStrategy)||sr.is(n.connectionStrategy)||Ke.is(n.messageStrategy))}r.is=e})(Xr||(h.ConnectionOptions=Xr={}));var U;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(U||(U={}));function ri(r,e,t,n){let s=t!==void 0?t:h.NullLogger,u=0,y=0,C=0,A="2.0",O,V=new Map,Q,oe=new Map,fe=new Map,nt,ae=new Qr.LinkedMap,Y=new Map,Me=new Set,K=new Map,_=g.Off,ce=B.Text,M,Z=U.New,it=new Ne.Emitter,br=new Ne.Emitter,vr=new Ne.Emitter,wr=new Ne.Emitter,_r=new Ne.Emitter,ee=n&&n.cancellationStrategy?n.cancellationStrategy:Qe.Message;function Sr(i){if(i===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+i.toString()}function hn(i){return i===null?"res-unknown-"+(++C).toString():"res-"+i.toString()}function pn(){return"not-"+(++y).toString()}function mn(i,a){f.Message.isRequest(a)?i.set(Sr(a.id),a):f.Message.isResponse(a)?i.set(hn(a.id),a):i.set(pn(),a)}function gn(i){}function Rr(){return Z===U.Listening}function Tr(){return Z===U.Closed}function he(){return Z===U.Disposed}function Pr(){(Z===U.New||Z===U.Listening)&&(Z=U.Closed,br.fire(void 0))}function yn(i){it.fire([i,void 0,void 0])}function bn(i){it.fire(i)}r.onClose(Pr),r.onError(yn),e.onClose(Pr),e.onError(bn);function Er(){nt||ae.size===0||(nt=(0,Gr.default)().timer.setImmediate(()=>{nt=void 0,vn()}))}function Cr(i){f.Message.isRequest(i)?_n(i):f.Message.isNotification(i)?Rn(i):f.Message.isResponse(i)?Sn(i):Tn(i)}function vn(){if(ae.size===0)return;let i=ae.shift();try{let a=n?.messageStrategy;Ke.is(a)?a.handleMessage(i,Cr):Cr(i)}finally{Er()}}let wn=i=>{try{if(f.Message.isNotification(i)&&i.method===Oe.type.method){let a=i.params.id,c=Sr(a),d=ae.get(c);if(f.Message.isRequest(d)){let v=n?.connectionStrategy,N=v&&v.cancelUndispatched?v.cancelUndispatched(d,gn):void 0;if(N&&(N.error!==void 0||N.result!==void 0)){ae.delete(c),K.delete(a),N.id=d.id,je(N,i.method,Date.now()),e.write(N).catch(()=>s.error("Sending response for canceled message failed."));return}}let S=K.get(a);if(S!==void 0){S.cancel(),st(i);return}else Me.add(a)}mn(ae,i)}finally{Er()}};function _n(i){if(he())return;function a(m,T,b){let j={jsonrpc:A,id:i.id};m instanceof f.ResponseError?j.error=m.toJson():j.result=m===void 0?null:m,je(j,T,b),e.write(j).catch(()=>s.error("Sending response failed."))}function c(m,T,b){let j={jsonrpc:A,id:i.id,error:m.toJson()};je(j,T,b),e.write(j).catch(()=>s.error("Sending response failed."))}function d(m,T,b){m===void 0&&(m=null);let j={jsonrpc:A,id:i.id,result:m};je(j,T,b),e.write(j).catch(()=>s.error("Sending response failed."))}Cn(i);let S=V.get(i.method),v,N;S&&(v=S.type,N=S.handler);let k=Date.now();if(N||O){let m=i.id??String(Date.now()),T=Je.is(ee.receiver)?ee.receiver.createCancellationTokenSource(m):ee.receiver.createCancellationTokenSource(i);i.id!==null&&Me.has(i.id)&&T.cancel(),i.id!==null&&K.set(m,T);try{let b;if(N)if(i.params===void 0){if(v!==void 0&&v.numberOfParams!==0){c(new f.ResponseError(f.ErrorCodes.InvalidParams,`Request ${i.method} defines ${v.numberOfParams} params but received none.`),i.method,k);return}b=N(T.token)}else if(Array.isArray(i.params)){if(v!==void 0&&v.parameterStructures===f.ParameterStructures.byName){c(new f.ResponseError(f.ErrorCodes.InvalidParams,`Request ${i.method} defines parameters by name but received parameters by position`),i.method,k);return}b=N(...i.params,T.token)}else{if(v!==void 0&&v.parameterStructures===f.ParameterStructures.byPosition){c(new f.ResponseError(f.ErrorCodes.InvalidParams,`Request ${i.method} defines parameters by position but received parameters by name`),i.method,k);return}b=N(i.params,T.token)}else O&&(b=O(i.method,i.params,T.token));let j=b;b?j.then?j.then(I=>{K.delete(m),a(I,i.method,k)},I=>{K.delete(m),I instanceof f.ResponseError?c(I,i.method,k):I&&P.string(I.message)?c(new f.ResponseError(f.ErrorCodes.InternalError,`Request ${i.method} failed with message: ${I.message}`),i.method,k):c(new f.ResponseError(f.ErrorCodes.InternalError,`Request ${i.method} failed unexpectedly without providing any details.`),i.method,k)}):(K.delete(m),a(b,i.method,k)):(K.delete(m),d(b,i.method,k))}catch(b){K.delete(m),b instanceof f.ResponseError?a(b,i.method,k):b&&P.string(b.message)?c(new f.ResponseError(f.ErrorCodes.InternalError,`Request ${i.method} failed with message: ${b.message}`),i.method,k):c(new f.ResponseError(f.ErrorCodes.InternalError,`Request ${i.method} failed unexpectedly without providing any details.`),i.method,k)}}else c(new f.ResponseError(f.ErrorCodes.MethodNotFound,`Unhandled method ${i.method}`),i.method,k)}function Sn(i){if(!he())if(i.id===null)i.error?s.error(`Received response message without id: Error is: 
${JSON.stringify(i.error,void 0,4)}`):s.error("Received response message without id. No further error information provided.");else{let a=i.id,c=Y.get(a);if(Nn(i,c),c!==void 0){Y.delete(a);try{if(i.error){let d=i.error;c.reject(new f.ResponseError(d.code,d.message,d.data))}else if(i.result!==void 0)c.resolve(i.result);else throw new Error("Should never happen.")}catch(d){d.message?s.error(`Response handler '${c.method}' failed with message: ${d.message}`):s.error(`Response handler '${c.method}' failed unexpectedly.`)}}}}function Rn(i){if(he())return;let a,c;if(i.method===Oe.type.method){let d=i.params.id;Me.delete(d),st(i);return}else{let d=oe.get(i.method);d&&(c=d.handler,a=d.type)}if(c||Q)try{if(st(i),c)if(i.params===void 0)a!==void 0&&a.numberOfParams!==0&&a.parameterStructures!==f.ParameterStructures.byName&&s.error(`Notification ${i.method} defines ${a.numberOfParams} params but received none.`),c();else if(Array.isArray(i.params)){let d=i.params;i.method===ke.type.method&&d.length===2&&tr.is(d[0])?c({token:d[0],value:d[1]}):(a!==void 0&&(a.parameterStructures===f.ParameterStructures.byName&&s.error(`Notification ${i.method} defines parameters by name but received parameters by position`),a.numberOfParams!==i.params.length&&s.error(`Notification ${i.method} defines ${a.numberOfParams} params but received ${d.length} arguments`)),c(...d))}else a!==void 0&&a.parameterStructures===f.ParameterStructures.byPosition&&s.error(`Notification ${i.method} defines parameters by position but received parameters by name`),c(i.params);else Q&&Q(i.method,i.params)}catch(d){d.message?s.error(`Notification handler '${i.method}' failed with message: ${d.message}`):s.error(`Notification handler '${i.method}' failed unexpectedly.`)}else vr.fire(i)}function Tn(i){if(!i){s.error("Received empty message.");return}s.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(i,null,4)}`);let a=i;if(P.string(a.id)||P.number(a.id)){let c=a.id,d=Y.get(c);d&&d.reject(new Error("The received response has neither a result nor an error property."))}}function te(i){if(i!=null)switch(_){case g.Verbose:return JSON.stringify(i,null,4);case g.Compact:return JSON.stringify(i);default:return}}function Pn(i){if(!(_===g.Off||!M))if(ce===B.Text){let a;(_===g.Verbose||_===g.Compact)&&i.params&&(a=`Params: ${te(i.params)}

`),M.log(`Sending request '${i.method} - (${i.id})'.`,a)}else pe("send-request",i)}function En(i){if(!(_===g.Off||!M))if(ce===B.Text){let a;(_===g.Verbose||_===g.Compact)&&(i.params?a=`Params: ${te(i.params)}

`:a=`No parameters provided.

`),M.log(`Sending notification '${i.method}'.`,a)}else pe("send-notification",i)}function je(i,a,c){if(!(_===g.Off||!M))if(ce===B.Text){let d;(_===g.Verbose||_===g.Compact)&&(i.error&&i.error.data?d=`Error data: ${te(i.error.data)}

`:i.result?d=`Result: ${te(i.result)}

`:i.error===void 0&&(d=`No result returned.

`)),M.log(`Sending response '${a} - (${i.id})'. Processing request took ${Date.now()-c}ms`,d)}else pe("send-response",i)}function Cn(i){if(!(_===g.Off||!M))if(ce===B.Text){let a;(_===g.Verbose||_===g.Compact)&&i.params&&(a=`Params: ${te(i.params)}

`),M.log(`Received request '${i.method} - (${i.id})'.`,a)}else pe("receive-request",i)}function st(i){if(!(_===g.Off||!M||i.method===He.type.method))if(ce===B.Text){let a;(_===g.Verbose||_===g.Compact)&&(i.params?a=`Params: ${te(i.params)}

`:a=`No parameters provided.

`),M.log(`Received notification '${i.method}'.`,a)}else pe("receive-notification",i)}function Nn(i,a){if(!(_===g.Off||!M))if(ce===B.Text){let c;if((_===g.Verbose||_===g.Compact)&&(i.error&&i.error.data?c=`Error data: ${te(i.error.data)}

`:i.result?c=`Result: ${te(i.result)}

`:i.error===void 0&&(c=`No result returned.

`)),a){let d=i.error?` Request failed: ${i.error.message} (${i.error.code}).`:"";M.log(`Received response '${a.method} - (${i.id})' in ${Date.now()-a.timerStart}ms.${d}`,c)}else M.log(`Received response ${i.id} without active response promise.`,c)}else pe("receive-response",i)}function pe(i,a){if(!M||_===g.Off)return;let c={isLSPMessage:!0,type:i,message:a,timestamp:Date.now()};M.log(c)}function Te(){if(Tr())throw new Se(xe.Closed,"Connection is closed.");if(he())throw new Se(xe.Disposed,"Connection is disposed.")}function kn(){if(Rr())throw new Se(xe.AlreadyListening,"Connection is already listening")}function xn(){if(!Rr())throw new Error("Call listen() first.")}function Pe(i){return i===void 0?null:i}function Nr(i){if(i!==null)return i}function kr(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function ot(i,a){switch(i){case f.ParameterStructures.auto:return kr(a)?Nr(a):[Pe(a)];case f.ParameterStructures.byName:if(!kr(a))throw new Error("Received parameters by name but param is not an object literal.");return Nr(a);case f.ParameterStructures.byPosition:return[Pe(a)];default:throw new Error(`Unknown parameter structure ${i.toString()}`)}}function xr(i,a){let c,d=i.numberOfParams;switch(d){case 0:c=void 0;break;case 1:c=ot(i.parameterStructures,a[0]);break;default:c=[];for(let S=0;S<a.length&&S<d;S++)c.push(Pe(a[S]));if(a.length<d)for(let S=a.length;S<d;S++)c.push(null);break}return c}let me={sendNotification:(i,...a)=>{Te();let c,d;if(P.string(i)){c=i;let v=a[0],N=0,k=f.ParameterStructures.auto;f.ParameterStructures.is(v)&&(N=1,k=v);let m=a.length,T=m-N;switch(T){case 0:d=void 0;break;case 1:d=ot(k,a[N]);break;default:if(k===f.ParameterStructures.byName)throw new Error(`Received ${T} parameters for 'by Name' notification parameter structure.`);d=a.slice(N,m).map(b=>Pe(b));break}}else{let v=a;c=i.method,d=xr(i,v)}let S={jsonrpc:A,method:c,params:d};return En(S),e.write(S).catch(v=>{throw s.error("Sending notification failed."),v})},onNotification:(i,a)=>{Te();let c;return P.func(i)?Q=i:a&&(P.string(i)?(c=i,oe.set(i,{type:void 0,handler:a})):(c=i.method,oe.set(i.method,{type:i,handler:a}))),{dispose:()=>{c!==void 0?oe.delete(c):Q=void 0}}},onProgress:(i,a,c)=>{if(fe.has(a))throw new Error(`Progress handler for token ${a} already registered`);return fe.set(a,c),{dispose:()=>{fe.delete(a)}}},sendProgress:(i,a,c)=>me.sendNotification(ke.type,{token:a,value:c}),onUnhandledProgress:wr.event,sendRequest:(i,...a)=>{Te(),xn();let c,d,S;if(P.string(i)){c=i;let m=a[0],T=a[a.length-1],b=0,j=f.ParameterStructures.auto;f.ParameterStructures.is(m)&&(b=1,j=m);let I=a.length;er.CancellationToken.is(T)&&(I=I-1,S=T);let G=I-b;switch(G){case 0:d=void 0;break;case 1:d=ot(j,a[b]);break;default:if(j===f.ParameterStructures.byName)throw new Error(`Received ${G} parameters for 'by Name' request parameter structure.`);d=a.slice(b,I).map(On=>Pe(On));break}}else{let m=a;c=i.method,d=xr(i,m);let T=i.numberOfParams;S=er.CancellationToken.is(m[T])?m[T]:void 0}let v=u++,N;S&&(N=S.onCancellationRequested(()=>{let m=ee.sender.sendCancellation(me,v);return m===void 0?(s.log(`Received no promise from cancellation strategy when cancelling id ${v}`),Promise.resolve()):m.catch(()=>{s.log(`Sending cancellation messages for id ${v} failed`)})}));let k={jsonrpc:A,id:v,method:c,params:d};return Pn(k),typeof ee.sender.enableCancellation=="function"&&ee.sender.enableCancellation(k),new Promise(async(m,T)=>{let b=G=>{m(G),ee.sender.cleanup(v),N?.dispose()},j=G=>{T(G),ee.sender.cleanup(v),N?.dispose()},I={method:c,timerStart:Date.now(),resolve:b,reject:j};try{Y.set(v,I),await e.write(k)}catch(G){throw Y.delete(v),I.reject(new f.ResponseError(f.ErrorCodes.MessageWriteError,G.message?G.message:"Unknown reason")),s.error("Sending request failed."),G}})},onRequest:(i,a)=>{Te();let c=null;return nr.is(i)?(c=void 0,O=i):P.string(i)?(c=null,a!==void 0&&(c=i,V.set(i,{handler:a,type:void 0}))):a!==void 0&&(c=i.method,V.set(i.method,{type:i,handler:a})),{dispose:()=>{c!==null&&(c!==void 0?V.delete(c):O=void 0)}}},hasPendingResponse:()=>Y.size>0,trace:async(i,a,c)=>{let d=!1,S=B.Text;c!==void 0&&(P.boolean(c)?d=c:(d=c.sendNotification||!1,S=c.traceFormat||B.Text)),_=i,ce=S,_===g.Off?M=void 0:M=a,d&&!Tr()&&!he()&&await me.sendNotification(ir.type,{value:g.toString(i)})},onError:it.event,onClose:br.event,onUnhandledNotification:vr.event,onDispose:_r.event,end:()=>{e.end()},dispose:()=>{if(he())return;Z=U.Disposed,_r.fire(void 0);let i=new f.ResponseError(f.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let a of Y.values())a.reject(i);Y=new Map,K=new Map,Me=new Set,ae=new Qr.LinkedMap,P.func(e.dispose)&&e.dispose(),P.func(r.dispose)&&r.dispose()},listen:()=>{Te(),kn(),Z=U.Listening,r.listen(wn)},inspect:()=>{(0,Gr.default)().console.log("inspect")}};return me.onNotification(He.type,i=>{if(_===g.Off||!M)return;let a=_===g.Verbose||_===g.Compact;M.log(i.message,a?i.verbose:void 0)}),me.onNotification(ke.type,i=>{let a=fe.get(i.token);a?a(i.value):wr.fire(i)}),me}h.createMessageConnection=ri});var Xe=q(o=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0});o.ProgressType=o.ProgressToken=o.createMessageConnection=o.NullLogger=o.ConnectionOptions=o.ConnectionStrategy=o.AbstractMessageBuffer=o.WriteableStreamMessageWriter=o.AbstractMessageWriter=o.MessageWriter=o.ReadableStreamMessageReader=o.AbstractMessageReader=o.MessageReader=o.SharedArrayReceiverStrategy=o.SharedArraySenderStrategy=o.CancellationToken=o.CancellationTokenSource=o.Emitter=o.Event=o.Disposable=o.LRUCache=o.Touch=o.LinkedMap=o.ParameterStructures=o.NotificationType9=o.NotificationType8=o.NotificationType7=o.NotificationType6=o.NotificationType5=o.NotificationType4=o.NotificationType3=o.NotificationType2=o.NotificationType1=o.NotificationType0=o.NotificationType=o.ErrorCodes=o.ResponseError=o.RequestType9=o.RequestType8=o.RequestType7=o.RequestType6=o.RequestType5=o.RequestType4=o.RequestType3=o.RequestType2=o.RequestType1=o.RequestType0=o.RequestType=o.Message=o.RAL=void 0;o.MessageStrategy=o.CancellationStrategy=o.CancellationSenderStrategy=o.CancellationReceiverStrategy=o.ConnectionError=o.ConnectionErrors=o.LogTraceNotification=o.SetTraceNotification=o.TraceFormat=o.TraceValues=o.Trace=void 0;var w=Mt();Object.defineProperty(o,"Message",{enumerable:!0,get:function(){return w.Message}});Object.defineProperty(o,"RequestType",{enumerable:!0,get:function(){return w.RequestType}});Object.defineProperty(o,"RequestType0",{enumerable:!0,get:function(){return w.RequestType0}});Object.defineProperty(o,"RequestType1",{enumerable:!0,get:function(){return w.RequestType1}});Object.defineProperty(o,"RequestType2",{enumerable:!0,get:function(){return w.RequestType2}});Object.defineProperty(o,"RequestType3",{enumerable:!0,get:function(){return w.RequestType3}});Object.defineProperty(o,"RequestType4",{enumerable:!0,get:function(){return w.RequestType4}});Object.defineProperty(o,"RequestType5",{enumerable:!0,get:function(){return w.RequestType5}});Object.defineProperty(o,"RequestType6",{enumerable:!0,get:function(){return w.RequestType6}});Object.defineProperty(o,"RequestType7",{enumerable:!0,get:function(){return w.RequestType7}});Object.defineProperty(o,"RequestType8",{enumerable:!0,get:function(){return w.RequestType8}});Object.defineProperty(o,"RequestType9",{enumerable:!0,get:function(){return w.RequestType9}});Object.defineProperty(o,"ResponseError",{enumerable:!0,get:function(){return w.ResponseError}});Object.defineProperty(o,"ErrorCodes",{enumerable:!0,get:function(){return w.ErrorCodes}});Object.defineProperty(o,"NotificationType",{enumerable:!0,get:function(){return w.NotificationType}});Object.defineProperty(o,"NotificationType0",{enumerable:!0,get:function(){return w.NotificationType0}});Object.defineProperty(o,"NotificationType1",{enumerable:!0,get:function(){return w.NotificationType1}});Object.defineProperty(o,"NotificationType2",{enumerable:!0,get:function(){return w.NotificationType2}});Object.defineProperty(o,"NotificationType3",{enumerable:!0,get:function(){return w.NotificationType3}});Object.defineProperty(o,"NotificationType4",{enumerable:!0,get:function(){return w.NotificationType4}});Object.defineProperty(o,"NotificationType5",{enumerable:!0,get:function(){return w.NotificationType5}});Object.defineProperty(o,"NotificationType6",{enumerable:!0,get:function(){return w.NotificationType6}});Object.defineProperty(o,"NotificationType7",{enumerable:!0,get:function(){return w.NotificationType7}});Object.defineProperty(o,"NotificationType8",{enumerable:!0,get:function(){return w.NotificationType8}});Object.defineProperty(o,"NotificationType9",{enumerable:!0,get:function(){return w.NotificationType9}});Object.defineProperty(o,"ParameterStructures",{enumerable:!0,get:function(){return w.ParameterStructures}});var ar=qt();Object.defineProperty(o,"LinkedMap",{enumerable:!0,get:function(){return ar.LinkedMap}});Object.defineProperty(o,"LRUCache",{enumerable:!0,get:function(){return ar.LRUCache}});Object.defineProperty(o,"Touch",{enumerable:!0,get:function(){return ar.Touch}});var ni=$r();Object.defineProperty(o,"Disposable",{enumerable:!0,get:function(){return ni.Disposable}});var Zr=be();Object.defineProperty(o,"Event",{enumerable:!0,get:function(){return Zr.Event}});Object.defineProperty(o,"Emitter",{enumerable:!0,get:function(){return Zr.Emitter}});var en=We();Object.defineProperty(o,"CancellationTokenSource",{enumerable:!0,get:function(){return en.CancellationTokenSource}});Object.defineProperty(o,"CancellationToken",{enumerable:!0,get:function(){return en.CancellationToken}});var tn=Ar();Object.defineProperty(o,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return tn.SharedArraySenderStrategy}});Object.defineProperty(o,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return tn.SharedArrayReceiverStrategy}});var cr=Br();Object.defineProperty(o,"MessageReader",{enumerable:!0,get:function(){return cr.MessageReader}});Object.defineProperty(o,"AbstractMessageReader",{enumerable:!0,get:function(){return cr.AbstractMessageReader}});Object.defineProperty(o,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return cr.ReadableStreamMessageReader}});var ur=Jr();Object.defineProperty(o,"MessageWriter",{enumerable:!0,get:function(){return ur.MessageWriter}});Object.defineProperty(o,"AbstractMessageWriter",{enumerable:!0,get:function(){return ur.AbstractMessageWriter}});Object.defineProperty(o,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return ur.WriteableStreamMessageWriter}});var ii=Vr();Object.defineProperty(o,"AbstractMessageBuffer",{enumerable:!0,get:function(){return ii.AbstractMessageBuffer}});var L=Yr();Object.defineProperty(o,"ConnectionStrategy",{enumerable:!0,get:function(){return L.ConnectionStrategy}});Object.defineProperty(o,"ConnectionOptions",{enumerable:!0,get:function(){return L.ConnectionOptions}});Object.defineProperty(o,"NullLogger",{enumerable:!0,get:function(){return L.NullLogger}});Object.defineProperty(o,"createMessageConnection",{enumerable:!0,get:function(){return L.createMessageConnection}});Object.defineProperty(o,"ProgressToken",{enumerable:!0,get:function(){return L.ProgressToken}});Object.defineProperty(o,"ProgressType",{enumerable:!0,get:function(){return L.ProgressType}});Object.defineProperty(o,"Trace",{enumerable:!0,get:function(){return L.Trace}});Object.defineProperty(o,"TraceValues",{enumerable:!0,get:function(){return L.TraceValues}});Object.defineProperty(o,"TraceFormat",{enumerable:!0,get:function(){return L.TraceFormat}});Object.defineProperty(o,"SetTraceNotification",{enumerable:!0,get:function(){return L.SetTraceNotification}});Object.defineProperty(o,"LogTraceNotification",{enumerable:!0,get:function(){return L.LogTraceNotification}});Object.defineProperty(o,"ConnectionErrors",{enumerable:!0,get:function(){return L.ConnectionErrors}});Object.defineProperty(o,"ConnectionError",{enumerable:!0,get:function(){return L.ConnectionError}});Object.defineProperty(o,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return L.CancellationReceiverStrategy}});Object.defineProperty(o,"CancellationSenderStrategy",{enumerable:!0,get:function(){return L.CancellationSenderStrategy}});Object.defineProperty(o,"CancellationStrategy",{enumerable:!0,get:function(){return L.CancellationStrategy}});Object.defineProperty(o,"MessageStrategy",{enumerable:!0,get:function(){return L.MessageStrategy}});var si=ne();o.RAL=si.default});var sn=q(hr=>{"use strict";Object.defineProperty(hr,"__esModule",{value:!0});var rn=require("util"),X=Xe(),Ye=class r extends X.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new rn.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Ye.emptyBuffer=Buffer.allocUnsafe(0);var dr=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),X.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),X.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),X.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),X.Disposable.create(()=>this.stream.off("data",e))}},lr=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),X.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),X.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),X.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,s)=>{let u=y=>{y==null?n():s(y)};typeof e=="string"?this.stream.write(e,t,u):this.stream.write(e,u)})}end(){this.stream.end()}},nn=Object.freeze({messageBuffer:Object.freeze({create:r=>new Ye(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new rn.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new dr(r),asWritableStream:r=>new lr(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function fr(){return nn}(function(r){function e(){X.RAL.install(nn)}r.install=e})(fr||(fr={}));hr.default=fr});var cn=q(p=>{"use strict";var oi=p&&p.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var s=Object.getOwnPropertyDescriptor(e,t);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,s)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),ai=p&&p.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&oi(e,r,t)};Object.defineProperty(p,"__esModule",{value:!0});p.createMessageConnection=p.createServerSocketTransport=p.createClientSocketTransport=p.createServerPipeTransport=p.createClientPipeTransport=p.generateRandomPipeName=p.StreamMessageWriter=p.StreamMessageReader=p.SocketMessageWriter=p.SocketMessageReader=p.PortMessageWriter=p.PortMessageReader=p.IPCMessageWriter=p.IPCMessageReader=void 0;var Re=sn();Re.default.install();var on=require("path"),ci=require("os"),ui=require("crypto"),tt=require("net"),z=Xe();ai(Xe(),p);var pr=class extends z.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),z.Disposable.create(()=>this.process.off("message",e))}};p.IPCMessageReader=pr;var mr=class extends z.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};p.IPCMessageWriter=mr;var gr=class extends z.AbstractMessageReader{constructor(e){super(),this.onData=new z.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};p.PortMessageReader=gr;var yr=class extends z.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};p.PortMessageWriter=yr;var de=class extends z.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,Re.default)().stream.asReadableStream(e),t)}};p.SocketMessageReader=de;var le=class extends z.WriteableStreamMessageWriter{constructor(e,t){super((0,Re.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};p.SocketMessageWriter=le;var Ze=class extends z.ReadableStreamMessageReader{constructor(e,t){super((0,Re.default)().stream.asReadableStream(e),t)}};p.StreamMessageReader=Ze;var et=class extends z.WriteableStreamMessageWriter{constructor(e,t){super((0,Re.default)().stream.asWritableStream(e),t)}};p.StreamMessageWriter=et;var an=process.env.XDG_RUNTIME_DIR,di=new Map([["linux",107],["darwin",103]]);function li(){let r=(0,ui.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;an?e=on.join(an,`vscode-ipc-${r}.sock`):e=on.join(ci.tmpdir(),`vscode-${r}.sock`);let t=di.get(process.platform);return t!==void 0&&e.length>t&&(0,Re.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}p.generateRandomPipeName=li;function fi(r,e="utf-8"){let t,n=new Promise((s,u)=>{t=s});return new Promise((s,u)=>{let y=(0,tt.createServer)(C=>{y.close(),t([new de(C,e),new le(C,e)])});y.on("error",u),y.listen(r,()=>{y.removeListener("error",u),s({onConnected:()=>n})})})}p.createClientPipeTransport=fi;function hi(r,e="utf-8"){let t=(0,tt.createConnection)(r);return[new de(t,e),new le(t,e)]}p.createServerPipeTransport=hi;function pi(r,e="utf-8"){let t,n=new Promise((s,u)=>{t=s});return new Promise((s,u)=>{let y=(0,tt.createServer)(C=>{y.close(),t([new de(C,e),new le(C,e)])});y.on("error",u),y.listen(r,"127.0.0.1",()=>{y.removeListener("error",u),s({onConnected:()=>n})})})}p.createClientSocketTransport=pi;function mi(r,e="utf-8"){let t=(0,tt.createConnection)(r,"127.0.0.1");return[new de(t,e),new le(t,e)]}p.createServerSocketTransport=mi;function gi(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function yi(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function bi(r,e,t,n){t||(t=z.NullLogger);let s=gi(r)?new Ze(r):r,u=yi(e)?new et(e):e;return z.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,z.createMessageConnection)(s,u,t,n)}p.createMessageConnection=bi});var dn=q((rs,un)=>{"use strict";un.exports=cn()});var Ii={};$n(Ii,{activate:()=>Di,deactivate:()=>$i});module.exports=In(Ii);var E=at(require("vscode")),ln=at(require("path")),fn=require("child_process"),x=at(dn()),vi=new x.RequestType0("editor/getText"),wi=new x.RequestType("editor/setText"),_i=new x.RequestType("editor/setTextInNew"),Si=new x.RequestType0("editor/getSelectedText"),Ri=new x.RequestType("editor/setSelectedText"),Ti=new x.RequestType("editor/setPosition"),Pi=new x.RequestType("editor/setSelection"),Ei=new x.RequestType0("editor/getSelectionStartIndex"),Ci=new x.RequestType0("editor/getSelectionLength"),Ni=new x.RequestType0("editor/saveCurrentDocument"),ki=new x.RequestType0("editor/setCSharpHighlighting"),xi=new x.RequestType("editor/tryOpen"),Oi=new x.RequestType0("editor/getCurrentFileName"),F=null,J=null;function Mi(r){let e=E.workspace.getConfiguration("csharpRegexTools").get("executablePath");if(e)return e;let t=process.arch==="ia32"?"x86":"x64";return ln.join(r.extensionPath,"bin",t,"CSharpRegexTools4VsCode.exe")}function rt(r,e){return r.positionAt(e)}function ji(r){return new E.Range(r.positionAt(0),r.positionAt(r.getText().length))}function H(){let r=E.window.activeTextEditor;if(!r)throw new Error("No active text editor");return r}function qi(r){r.onRequest(vi,()=>H().document.getText()),r.onRequest(wi,async({text:e})=>{let t=H();await t.edit(n=>{n.replace(ji(t.document),e)})}),r.onRequest(_i,async({text:e})=>{let t=await E.workspace.openTextDocument({content:e});await E.window.showTextDocument(t)}),r.onRequest(Si,()=>{let e=H();return e.document.getText(e.selection)}),r.onRequest(Ri,async({text:e})=>{let t=H();await t.edit(n=>{n.replace(t.selection,e)})}),r.onRequest(Ti,async({index:e,length:t})=>{let n=H(),s=rt(n.document,e),u=rt(n.document,e+t);n.selection=new E.Selection(s,u),n.revealRange(new E.Range(s,u),E.TextEditorRevealType.InCenterIfOutsideViewport),await E.window.showTextDocument(n.document,n.viewColumn)}),r.onRequest(Pi,({index:e,length:t})=>{let n=H(),s=rt(n.document,e),u=rt(n.document,e+t),y=new E.Selection(s,u);n.selections=[...n.selections,y]}),r.onRequest(Ei,()=>{let e=H();return e.document.offsetAt(e.selection.start)}),r.onRequest(Ci,()=>{let e=H();return e.document.offsetAt(e.selection.end)-e.document.offsetAt(e.selection.start)}),r.onRequest(Ni,async()=>{await H().document.save()}),r.onRequest(ki,async()=>{let e=H();await E.languages.setTextDocumentLanguage(e.document,"csharp")}),r.onRequest(xi,async({fileName:e,onlyIfAlreadyOpen:t})=>{for(let n of E.workspace.textDocuments)if(n.fileName.toLowerCase()===e.toLowerCase())return await E.window.showTextDocument(n),!0;if(t)return!1;try{let n=await E.workspace.openTextDocument(e);return await E.window.showTextDocument(n),!0}catch{return!1}}),r.onRequest(Oi,()=>H().document.fileName)}function Li(r){let e=Mi(r);F=(0,fn.spawn)(e,[],{stdio:["pipe","pipe","pipe"]}),F.stderr?.on("data",t=>{console.error(`[CSharpRegexTools] ${t.toString()}`)}),F.on("exit",t=>{console.log(`[CSharpRegexTools] Process exited with code ${t}`),J=null,F=null}),J=(0,x.createMessageConnection)(new x.StreamMessageReader(F.stdout),new x.StreamMessageWriter(F.stdin)),qi(J),J.listen(),J.sendNotification("window/show")}function Di(r){let e=E.commands.registerCommand("csharpRegexTools.open",()=>{J&&F&&!F.killed?J.sendNotification("window/show"):Li(r)});r.subscriptions.push(e)}function $i(){if(J){try{J.sendNotification("shutdown")}catch{}J.dispose(),J=null}F&&!F.killed&&(F.kill(),F=null)}0&&(module.exports={activate,deactivate});
